<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Golden Lamtouch Admin Login</title>
    
    <link rel="stylesheet" href="style.css">

    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <!-- Updated Font: Rajdhani -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body class="bg-[#121212] font-display text-[#E0E0E0] antialiased">
    <div class="relative flex h-screen min-h-screen w-full flex-col items-center justify-center overflow-hidden p-4">
        <div class="w-full max-w-md rounded-xl bg-[#1E1E1E] p-8 shadow-2xl border border-[#3b4754]">
            <div class="flex flex-col items-center mb-6">
                <!-- LOGO REPLACEMENT -->
                <img src="logo.png" alt="Golden Lamtouch Logo" class="h-16 w-auto mb-4 rounded-lg">
                <h1 class="text-white tracking-light text-center text-3xl font-bold leading-tight">Admin Portal</h1>
            </div>
            
            <form class="flex w-full flex-col gap-6" id="login-form">
                
                <div class="flex flex-col">
                    <label class="pb-2 text-base font-medium leading-normal text-[#E0E0E0]" for="email">Email</label>
                    <input class="form-input h-14 w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg border border-[#3b4754] bg-[#1c2127] p-[15px] text-base font-normal leading-normal text-white placeholder:text-[#9dabb9] focus:border-[#FFC107] focus:outline-0 focus:ring-2 focus:ring-[#FFC107]/50" id="email" placeholder="Enter your email" type="email" value="" />
                </div>
                
                <div class="flex flex-col">
                    <label class="pb-2 text-base font-medium leading-normal text-[#E0E0E0]" for="password">Password</label>
                    <div class="relative flex w-full flex-1 items-stretch">
                        <input class="form-input h-14 w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg border border-[#3b4754] bg-[#1c2127] p-[15px] text-base font-normal leading-normal text-white placeholder:text-[#9dabb9] focus:border-[#FFC107] focus:outline-0 focus:ring-2 focus:ring-[#FFC107]/50" id="password" placeholder="Enter your password" type="password" value="" />
                        <div class="absolute inset-y-0 right-0 flex items-center pr-4 text-[#9dabb9]">
                            <span class="material-symbols-outlined cursor-pointer text-2xl">
                                visibility_off
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col pt-2">
                    <button class="flex h-12 min-w-[84px] w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-[#FFC107] px-5 text-base font-bold leading-normal tracking-[0.015em] text-black transition-colors hover:bg-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 focus:ring-offset-[#1E1E1E]" id="login-button" type="submit">
                        <span class="truncate">Login</span>
                    </button>
                </div>
                
                <div class="hidden h-6 items-center justify-center pt-1 text-center text-sm text-[#CF6679]" id="error-message">
                    <span>Invalid credentials. Please try again.</span>
                </div>
            </form>

            <!-- Documentation Link -->
            <div class="mt-6 text-center">
                <button id="open-docs-button" class="text-xs text-gray-500 hover:text-gray-300 underline">
                    System Documentation
                </button>
            </div>
        </div>
    </div>

    <!-- Documentation Modal -->
    <div id="docs-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-[#1E1E1E] rounded-xl shadow-2xl border border-[#3b4754] w-full max-w-4xl h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-[#3b4754]">
                <h2 class="text-xl font-bold text-white">System Documentation</h2>
                <button id="close-docs-button" class="p-1 rounded-full text-gray-400 hover:bg-white/10 hover:text-white">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-8 overflow-y-auto text-gray-300 leading-relaxed font-mono text-sm">
                <pre class="whitespace-pre-wrap font-sans">
# Golden Lamtouch - Cloud Architecture Documentation

## Overview
This document outlines the technical architecture for the **Golden Lamtouch** admin panel and data collection system. It details the frontend structure, database schema, file storage strategy, and the serverless cloud infrastructure ("The Brain").

---

## 1. Frontend (The User Interface)
**Stack:** HTML5, Vanilla JavaScript (ES6+), Tailwind CSS.
**Hosting:** Static Web Hosting (Currently Local / Ready for Firebase Hosting).

### Key Pages & Logic:
* **`index.html`**: The Login Gate. Uses Firebase Auth to protect the admin panel.
* **`dashboard.html`**: The Analytics Hub. Displays real-time submission counts and charts.
* **`form-management.html`**: The Control Center. Allows admins to Create, Edit, and Delete forms, as well as manage Groups and generate OTPs.
* **`data-download.html`**: The **Smart Dashboard**. Allows admins to view submission stats by period and download full reports (CSV + Images) in a single click.
* **`form.html`**: The Public-Facing Form. Users enter an OTP to unlock and submit data.
* **`form-creation.html`**: The Builder. A dynamic interface for designing new forms with various field types.

---

## 2. Database (Firestore)
**Type:** NoSQL Real-time Database.
**Location:** `us-central1` (Default).

### Collections Schema:
1.  **`forms`**: Stores form blueprints.
    * `formName` (string): Display name.
    * `fields` (array): List of field objects (type, label, validation).
    * `isPrepaid` (boolean): Payment configuration.
    * `lastDownloadDate` (timestamp): Used for "Partial Download" logic.
    * *Sub-collection:* `private/counter` (Stores `lastNumber` for serial generation).
2.  **`submissions`**: Stores user entries.
    * `serialNumber` (string): Unique ID (e.g., "250001").
    * `formId` (string): Link to parent form.
    * `otp` (string): The code used to access the form.
    * `status` (string): "Submitted", "Pending", etc.
    * `[dynamic_fields]`: Answers to form questions.
3.  **`otps`**: Stores access codes.
    * `code` (string): The 6-character code.
    * `isUsed` (boolean): Prevents reuse.
    * `formId` (string): Links OTP to a specific form.
4.  **`groups`**: Stores categories for organizing forms.
5.  **`config`**: Stores global settings.
    * `global/serialPrefix`: The year prefix (e.g., "25").

---

## 3. File Storage (Firebase Storage)
**Bucket:** `golden-lamtouch-project.firebasestorage.app`
**Location:** Google Cloud Storage.

### Structure:
* **Path:** `submissions/{formId}/{serialNumber}_{fieldName}.jpg`
* **Logic:** Files are renamed upon upload to match the submission's Serial Number for easy identification.

---

## 4. The "Super-Brain" (Cloud Functions V2)
**Runtime:** Node.js 20.
**Region Strategy:** Hybrid (India/US).
**Identity:** Runs as "Default Compute Service Account".

### Function 1: `onSubmissionCreate`
* **Type:** Firestore Trigger (Background).
* **Region:** `us-central1` (Must match Database).
* **Trigger:** Document Creation in `submissions/{id}`.
* **Job:**
    1.  Reads global prefix (e.g., "25").
    2.  Runs a Transaction on `forms/{id}/private/counter` to get the next number safely.
    3.  Generates Serial Number (e.g., "250001").
    4.  Updates the submission document with this new ID.

### Function 2: `onFormDelete`
* **Type:** HTTPS Callable (On-Demand).
* **Region:** `asia-south1` (Mumbai).
* **Job:** "Cascading Delete."
    1.  Deletes the Form document.
    2.  Deletes all Submissions for that form.
    3.  Deletes all OTPs for that form.
    4.  Deletes all Images in Storage for that form.

### Function 3: `createFullReportZip` (The Heavy Lifter)
* **Type:** HTTPS Callable (On-Demand).
* **Region:** `asia-south1` (Mumbai).
* **Configuration:** 1GB Memory, 540s Timeout.
* **Job:**
    1.  Fetches all submissions for the requested Form.
    2.  Generates a **CSV** in memory. *Logic Fix:* Replaces Image URLs in the CSV with the `serialNumber` for cleaner reporting.
    3.  Downloads all associated images from Storage.
    4.  Creates a **.zip** file containing the CSV and all images.
    5.  Uploads the .zip to a temporary Storage location.
    6.  Generates a **Signed URL** (valid for 15 minutes).
    7.  Returns the URL to the frontend for immediate download.

---

## 5. Security & Access Control
* **Authentication:** Firebase Auth (Email/Password).
* **Auth Guard:** Client-side check (`auth-guard.js`) ensures only logged-in users access admin pages.
* **Backend Security:** All Callable Functions (`onFormDelete`, `createFullReportZip`) strictly verify `context.auth` before executing.
* **IAM Permissions:** The "Compute Engine Service Account" has been granted `Service Account Token Creator` role to allow signing of secure download URLs.
                </pre>
            </div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyAJ-xyOPmJXmhe9PUCa1BU75fWJ_MWsHA0",
          authDomain: "golden-lamtouch-project.firebaseapp.com",
          projectId: "golden-lamtouch-project",
          storageBucket: "golden-lamtouch-project.firebasestorage.app",
          messagingSenderId: "528955254323",
          appId: "1:528955254323:web:e71517dab7fcb78b842546"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>

    <script src="login.js"></script>

</body>
</html>